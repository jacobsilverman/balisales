"use strict";(self.webpackChunkbalisales=self.webpackChunkbalisales||[]).push([[242],{6502:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var i=n(4165),l=n(5861),r=n(1413),a=n(3433),o=n(9439),s=n(2791),d=n(3675),c=n(6519),u=n(9743),h=n(2677),p=n(6157),v=n(9230),f=n(184),m=function(e){var t=e.deletePost,n=e.item,i=e.openDeleteModal,l=e.setOpenDeleteModal,r=e.setOpenEditModal,a=(0,v.$G)().t;return(0,f.jsx)(c.Z,{open:i,id:"delete-modal",children:(0,f.jsx)(u.Z,{className:"modal-dialog delete-modal",children:(0,f.jsxs)(h.Z,{xs:2,className:"modal-content modal-background-edit center",children:[(0,f.jsx)(u.Z,{className:"modal-header",children:(0,f.jsx)(h.Z,{className:"modal-title",children:a("Do you want to delete this post?")})}),(0,f.jsx)("br",{}),(0,f.jsxs)(u.Z,{children:[(0,f.jsx)(h.Z,{xs:6,children:(0,f.jsx)(p.Z,{onClick:function(){return l(!1)},children:a("No")})}),(0,f.jsx)(h.Z,{xs:6,children:(0,f.jsx)(p.Z,{onClick:function(){t(n).then((function(){return r(!1)})),l(!1)},children:a("Yes")})})]})]})})})},x=n(1648),Z=n(9891),b=n(1747),g=n(7391),j=n(6362),y=n(4925),w=n(8588),C=n(9062),k=n(2892),S=n(6278),N=n(4453),P=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(t,n){var l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=(0,C.JU)(k.db,"".concat((0,d.NZ)(),"-posts"),n),e.next=3,(0,C.pl)(l,t).then((function(){console.log("POST EDIT SAVED")})).catch((function(e){console.error("problem: ",e)}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),D=function(e){var t=e.item,n=e.setPosts,D=e.openEditModal,M=e.setOpenEditModal,I=e.filterPosts,z=e.setFilterPosts,E=(0,s.useState)(null===t||void 0===t?void 0:t.title),T=(0,o.Z)(E,2),F=T[0],O=T[1],R=(0,s.useState)(null===t||void 0===t?void 0:t.description),L=(0,o.Z)(R,2),V=L[0],B=L[1],H=(0,s.useState)(null===t||void 0===t?void 0:t.type),W=(0,o.Z)(H,2),q=W[0],U=W[1],$=(0,s.useState)(null===t||void 0===t?void 0:t.blade),G=(0,o.Z)($,2),X=G[0],A=G[1],J=(0,s.useState)(null===t||void 0===t?void 0:t.brand),Y=(0,o.Z)(J,2),_=Y[0],Q=Y[1],K=(0,s.useState)(null===t||void 0===t?void 0:t.condition),ee=(0,o.Z)(K,2),te=ee[0],ne=ee[1],ie=(0,s.useState)(null===t||void 0===t?void 0:t.price),le=(0,o.Z)(ie,2),re=le[0],ae=le[1],oe=(0,s.useState)(null===t||void 0===t?void 0:t.status),se=(0,o.Z)(oe,2),de=se[0],ce=se[1],ue=(0,s.useState)(!1),he=(0,o.Z)(ue,2),pe=he[0],ve=he[1],fe=(0,s.useState)(!1),me=(0,o.Z)(fe,2),xe=me[0],Ze=me[1],be=(0,s.useState)(null===t||void 0===t?void 0:t.urls),ge=(0,o.Z)(be,2),je=ge[0],ye=ge[1],we=(0,s.useState)({title:!0,type:!0,blade:!0,brand:!0,condition:!0,price:!0,picture:!0,status:!0}),Ce=(0,o.Z)(we,2),ke=Ce[0],Se=Ce[1],Ne=(0,v.$G)().t;(0,s.useEffect)((function(){var e=!1;return e||(O(null===t||void 0===t?void 0:t.title),B(null===t||void 0===t?void 0:t.description),U(null===t||void 0===t?void 0:t.type),A(null===t||void 0===t?void 0:t.blade),Q(null===t||void 0===t?void 0:t.brand),ne(null===t||void 0===t?void 0:t.condition),ae(null===t||void 0===t?void 0:t.price),ce(null===t||void 0===t?void 0:t.status),ye(null===t||void 0===t?void 0:t.urls)),function(){return e=!0}}),[t]);var Pe=(0,s.useMemo)((function(){var e=!Object.values(ke).some((function(e){return!1===e}));return!0===e&&Ze(!1),e}),[ke]),De=function(e,t){return e.map((function(e){return(0,f.jsx)(Z.Z,{value:e,children:Ne(e)},t+"-"+e)}))},Me=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(t){var n,l,r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,N.cF)(),l=(0,C.JU)(k.db,"".concat((0,d.NZ)(),"-posts"),t.id),e.next=4,(0,C.oe)(l);case 4:(0,S.sq)(t.id),r=0;case 6:if(!(r<t.numberOfImages)){e.next=13;break}return a=(0,N.iH)(n,"".concat((0,d.NZ)(),"-postImages/").concat(t.id,"/image-").concat(r)),e.next=10,(0,N.oq)(a);case 10:r++,e.next=6;break;case 13:z(null===I||void 0===I?void 0:I.filter((function(e){return e.id!==t.id})));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,l.Z)((0,i.Z)().mark((function e(){var n,r,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,N.cF)(),r=(0,N.iH)(n,"".concat((0,d.NZ)(),"-postImages/").concat(t.id)),a={},e.next=6,Promise.all(je.map(function(){var e=(0,l.Z)((0,i.Z)().mark((function e(t,n){var l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof t){e.next=4;break}a[n]=t,e.next=9;break;case 4:return(l=new XMLHttpRequest).responseType="blob",e.next=8,new Promise((function(e,n){l.onload=function(t){var i=l.response;i?e(i):n(new Error("Failed to fetch blob"))},l.onerror=function(e){n(new Error("XHR request failed"))},l.open("GET",t),l.send()}));case 8:a[n]=e.sent;case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:return e.next=8,(0,N.aF)(r);case 8:return o=e.sent,e.next=11,Promise.all(o.items.map(function(){var e=(0,l.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,N.oq)(t);case 3:console.log("Deleted ".concat(t.fullPath)),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Error deleting ".concat(t.fullPath,": ").concat(e.t0.message));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()));case 11:return s=Object.keys(a).map(function(){var e=(0,l.Z)((0,i.Z)().mark((function e(l){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,N.iH)(n,"".concat((0,d.NZ)(),"-postImages/").concat(t.id,"/image-").concat(l)),e.abrupt("return",(0,N.B0)(r,a[l]));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=14,Promise.all(s);case 14:c=e.sent,console.log("blobMap uploaded: ",c),window.location.reload(),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.error(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(){return e.apply(this,arguments)}}(),ze=(0,s.useState)({display:"block"}),Ee=(0,o.Z)(ze,2),Te=Ee[0],Fe=Ee[1];return(0,f.jsx)(c.Z,{style:Te,open:D,onClick:function(){return M(!1)},children:(0,f.jsx)(u.Z,{className:"edit-modal",children:(0,f.jsxs)(h.Z,{xs:7,className:"modal-background-edit center",onClick:function(e){return e.stopPropagation()},children:[(0,f.jsx)(p.Z,{variant:"outlined",id:"select-modal-exit-button",color:"error",onClick:function(e){M(!1),O(null===t||void 0===t?void 0:t.title),B(null===t||void 0===t?void 0:t.description),U(null===t||void 0===t?void 0:t.type),A(null===t||void 0===t?void 0:t.blade),Q(null===t||void 0===t?void 0:t.brand),ne(null===t||void 0===t?void 0:t.condition),ae(null===t||void 0===t?void 0:t.price),ce(null===t||void 0===t?void 0:t.status),ye(null===t||void 0===t?void 0:t.urls)},children:"X"}),(0,f.jsx)(m,{deletePost:Me,item:t,openDeleteModal:pe,setOpenDeleteModal:ve,setOpenEditModal:M}),(0,f.jsxs)(u.Z,{className:"edit-input",children:[(0,f.jsx)(h.Z,{xs:4,className:"left",children:(0,f.jsx)("h2",{children:Ne("Edit")})}),(0,f.jsx)(h.Z,{children:(0,f.jsx)(g.Z,{error:!ke.title,fullWidth:!0,size:"small",value:F,label:Ne("Title"),className:"input-width",onChange:function(e){var t=e.target.value;t.match(/['\-"><;:\\+{}!@#$%=^*_|[\]]/)||(Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{title:""!==t})})),O(t))}})})]}),(0,f.jsxs)(u.Z,{className:"edit-input",children:[(0,f.jsx)(h.Z,{sm:4,children:(0,f.jsxs)(j.Z,{fullWidth:!0,children:[(0,f.jsx)(y.Z,{error:!1===ke.status&&xe,size:"small",id:"status-edit-label",children:Ne("Status")}),(0,f.jsx)(w.Z,{labelId:"status-edit-label",id:"status-edit-select",size:"small",defaultValue:null===t||void 0===t?void 0:t.status,value:de,label:Ne("Status"),onChange:function(e){var t=e.target.value;""!==t&&Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{status:!0})})),ce(t)},children:De(d.Do,"status")})]})}),(0,f.jsx)(h.Z,{sm:4,children:(0,f.jsxs)(j.Z,{fullWidth:!0,children:[(0,f.jsx)(y.Z,{error:!1===ke.type&&xe,size:"small",id:"business-edit-label",children:Ne("Sale Type")}),(0,f.jsx)(w.Z,{labelId:"business-edit-label",id:"business-edit-select",size:"small",defaultValue:null===t||void 0===t?void 0:t.type,value:q,label:Ne("Sale Type"),onChange:function(e){var t=e.target.value;""!==t&&Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{type:!0})})),U(t)},children:De(d.V5,"type")})]})}),(0,f.jsx)(h.Z,{sm:4,children:(0,f.jsx)(g.Z,{fullWidth:!0,size:"small",value:re,type:"number",label:Ne("Price"),onChange:function(e){var t=e.target.value;t.match(/['\-"]/)||(Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{price:""!==t})})),ae(t))}})})]}),(0,f.jsxs)(u.Z,{className:"edit-input",children:[(0,f.jsx)(h.Z,{sm:4,children:(0,f.jsxs)(j.Z,{fullWidth:!0,children:[(0,f.jsx)(y.Z,{error:!1===ke.brand&&xe,size:"small",id:"brand-edit-label",children:Ne("Brand")}),(0,f.jsx)(w.Z,{labelId:"brand-edit-label",id:"brand-edit-select",size:"small",defaultValue:null===t||void 0===t?void 0:t.brand,value:_,label:Ne("Brand"),onChange:function(e){var t=e.target.value;""!==t&&Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{brand:!0})})),Q(t)},children:De(d.YS,"brand")})]})}),(0,f.jsx)(h.Z,{sm:4,children:(0,f.jsxs)(j.Z,{fullWidth:!0,error:!1===ke.blade&&xe,children:[(0,f.jsx)(y.Z,{id:"blade-edit-label",size:"small",children:Ne("Blade")}),(0,f.jsx)(w.Z,{labelId:"blade-edit-label",id:"blade-edit-select",size:"small",defaultValue:null===t||void 0===t?void 0:t.blade,value:X,label:Ne("Blade"),onChange:function(e){var t=e.target.value;""!==t&&Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{blade:!0})})),A(t)},children:De(d.SP,"blade")})]})}),(0,f.jsx)(h.Z,{sm:4,children:(0,f.jsxs)(j.Z,{fullWidth:!0,children:[(0,f.jsx)(y.Z,{error:!1===ke.condition&&xe,size:"small",id:"condition-edit-label",children:Ne("Condition")}),(0,f.jsx)(w.Z,{labelId:"condition-edit-label",id:"condition-edit-select",size:"small",defaultValue:null===t||void 0===t?void 0:t.condition,value:te,label:Ne("Condition"),onChange:function(e){var t=e.target.value;""!==t&&Se((function(e){return(0,r.Z)((0,r.Z)({},e),{},{condition:!0})})),ne(t)},children:De([1,2,3,4,5,6,7,8,9,10],"condition")})]})})]}),(0,f.jsx)(u.Z,{className:"edit-input",children:(0,f.jsx)(h.Z,{xs:12,children:(0,f.jsx)(b.Z,{style:{width:"100%"},minRows:3,value:V,placeholder:Ne("Description"),label:Ne("Description"),onChange:function(e){var t=e.target.value;t.match(/['\-"><;:\\+{}!@#$%=^*_|[\]]/)||B(t)}})})}),(0,f.jsx)(x.C,{files:je,setFiles:ye,validation:ke,setValidation:Se,disableSubmit:xe,setDisplay:Fe}),(0,f.jsxs)(u.Z,{className:"edit-input",children:[(0,f.jsx)(h.Z,{xs:6,children:(0,f.jsx)(p.Z,{variant:"danger",onClick:function(e){e.preventDefault(),ve(!0)},children:Ne("Delete")})}),(0,f.jsx)(h.Z,{xs:6,children:(0,f.jsx)(p.Z,{disabled:xe,onClick:function(){Pe?(Pe&&P({title:F,type:q,blade:X,brand:_,condition:te,price:re,description:V,status:de,timeStamp:t.timeStamp,editTimeStamp:Date.now(),numberOfImages:je.length,author:{name:t.author.name,id:t.author.id}},t.id).then((function(e){n((function(e){return(0,a.Z)(e.map((function(e){return e.id===t.id?(0,r.Z)((0,r.Z)({},t),{},{title:F,type:q,blade:X,brand:_,condition:te,price:re,description:V,status:de}):e})))})),console.log("result: ",e)})).catch((function(e){console.error("problem when saving the edit post: ",e)})),Ie(),M(!1)):Ze(!0)},children:Ne("Submit")})})]})]})})})},M=D},1648:function(e,t,n){n.d(t,{C:function(){return g}});var i=n(1413),l=n(3433),r=n(9439),a=n(9135),o=n(3675),s=n(2791),d=n(9743),c=n(2677),u=n(6157),h=n(1889),p=n(7621),v=n(9230),f=n(6151),m=n(4727),x=n(5419),Z=(n(9390),n(184)),b=function(e){var t=e.imageLoaded,n=e.setImageLoaded,a=e.imageToCrop,o=e.showCropModal,d=e.setShowCropModal,c=e.setFiles,u=e.setValidation,h=e.setDisplay,p=(0,s.useState)(),v=(0,r.Z)(p,2),b=v[0],g=v[1],j=(0,s.useState)(null),y=(0,r.Z)(j,2),w=y[0],C=y[1],k=(0,s.useState)(null),S=(0,r.Z)(k,2),N=S[0],P=S[1],D=(0,s.useState)(null),M=(0,r.Z)(D,2),I=M[0],z=M[1],E=a?URL.createObjectURL(a):null,T=function(){d(!1),g(),C(),P(),h&&h({display:"block"})};return(0,Z.jsxs)(m.Z,{id:"croppingModal",show:o,onBackdropClick:function(){return T()},children:[(0,Z.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",padding:"5px"},children:(0,Z.jsx)(f.Z,{onClick:T,color:"error",children:"close"})}),(0,Z.jsx)("div",{className:"center",children:"Resizing image to fit the 250px 300px dimensions"}),a&&(0,Z.jsx)(x.ZP,{crop:b,onChange:function(e){return g(e)},children:(0,Z.jsx)("img",{src:E,onLoad:function(e){if(C(e.currentTarget),a&&!t){var i=e.currentTarget,l=i.width,r=i.height,o=l-250,s=r-300,d=0,c=0;if(s<o){var u=(l-.83*r)/2;l=.83*r,d=u}else if(s>o){var h=(r-(l+.17*l))/2;r=l+.17*l,c=h}g({unit:"px",width:l,height:r,x:d,y:c}),n(!0)}}})}),(0,Z.jsx)(f.Z,{variant:"outlined",onClick:function(){return function(){var e=document.createElement("canvas"),t=w.naturalWidth/w.width,n=w.naturalHeight/w.height;e.width=b.width,e.height=b.height;var i=e.getContext("2d"),l=window.devicePixelRatio;e.width=b.width*l,e.height=b.height*l,i.setTransform(l,0,0,l,0,0),i.imageSmoothingQuality="high",i.drawImage(w,b.x*t,b.y*n,b.width*t,b.height*n,0,0,b.width,b.height);var r=e.toDataURL("image/jpeg");P(r),e.toBlob((function(e){z(e);var t=document.getElementById("croppingModal");t.parentElement.scrollTo({left:0,top:t.scrollHeight,behavior:"smooth"})}))}()},children:"Preview"}),N&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{className:"center",children:(0,Z.jsx)("img",{src:N,style:{height:"300px",width:"250px"}})}),(0,Z.jsx)(f.Z,{variant:"contained",color:"success",onClick:function(){T(),c((function(e){return[].concat((0,l.Z)(e),[I])})),u((function(e){return(0,i.Z)((0,i.Z)({},e),{},{picture:!0})}))},children:"Submit"})]})]})},g=function(e){var t=e.files,n=e.setFiles,f=e.validation,m=e.setValidation,x=e.disableSubmit,g=e.setDisplay,j=(null===t||void 0===t?void 0:t.length)<=1?"200px":"100px",y=(0,v.$G)().t,w=(0,s.useState)(),C=(0,r.Z)(w,2),k=C[0],S=C[1],N=(0,s.useState)(!1),P=(0,r.Z)(N,2),D=P[0],M=P[1],I=(0,Z.jsx)(d.Z,{className:"edit-input",children:(0,Z.jsx)(c.Z,{xs:12,className:"setting-item",children:(0,Z.jsxs)("label",{className:"profile-label center",style:{color:!1===f.picture&&x?"red":"black"},htmlFor:"add-post-image",children:[(0,Z.jsx)("input",{id:"add-post-image",className:"profile-input",type:"file",onChange:function(e){g&&g({display:"none"}),S(e.target.files[0]),M(!0),O(!1)},accept:"image/*"}),(0,Z.jsx)("span",{children:y("Add Picture")}),(0,Z.jsx)("br",{}),(0,Z.jsx)(a.H3h,{size:40})]})})}),z=(0,Z.jsx)(h.ZP,{justifyContent:"center",container:!0,spacing:3,children:null===t||void 0===t?void 0:t.map((function(e,r){var a="string"!==typeof e?URL.createObjectURL(e):e,s=0===r?"flex-end":r!==t.length-1?"space-between":"flex-start";return(0,Z.jsx)(h.ZP,{item:!0,children:(0,Z.jsxs)(p.Z,{children:[(0,Z.jsx)(u.Z,{variant:"danger",style:{width:"100%",borderRadius:"0px"},onClick:function(){return function(e){var l=null===t||void 0===t?void 0:t.filter((function(t,n){return n!==e}));0===l.length&&m((function(e){return(0,i.Z)((0,i.Z)({},e),{},{picture:!1})})),n(l)}(r)},children:y("Remove")}),(0,Z.jsx)(h.ZP,{item:!0,className:"center",style:{backgroundImage:"url(".concat(a,")"),backgroundSize:"100% 100%",width:j,height:j}},a+"item"),(0,Z.jsxs)("div",{style:{display:"flex",justifyContent:s},children:[r>0&&(0,Z.jsx)(u.Z,{variant:"outlined",onClick:function(){return function(e){e<=0||n((function(t){var n=(0,l.Z)(t),i=n[e-1];return n[e-1]=n[e],n[e]=i,n}))}(r)},children:o.tq?"^":"<"}),r<t.length-1&&(0,Z.jsx)(u.Z,{variant:"outlined",onClick:function(){return function(e){e>=(null===t||void 0===t?void 0:t.length)-1||n((function(t){var n=(0,l.Z)(t),i=n[e+1];return n[e+1]=n[e],n[e]=i,n}))}(r)},children:o.tq?"v":">"})]})]})},a)}))}),E=(0,s.useState)(!1),T=(0,r.Z)(E,2),F=T[0],O=T[1];return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(b,{imageLoaded:F,setImageLoaded:O,imageToCrop:k,showCropModal:D,setShowCropModal:M,setValidation:m,setFiles:n,setDisplay:g}),I,z]})}}}]);
//# sourceMappingURL=242.80d250e7.chunk.js.map